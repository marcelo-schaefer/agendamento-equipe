<p-card>
  <p-toast />
  <ng-template pTemplate="title">
    <h2>Agendamentos Gravados</h2>
  </ng-template>

  <div class="mb-4">
    <div
      class="form-responsive"
      style="display: flex; gap: 0.5rem; align-items: start"
    >
      <button
        pButton
        type="button"
        label="Visualização de Datas"
        [disabled]="desabilitar"
        (click)="apresentarFiltroData = true"
      ></button>

      <app-busca-colaboradores
        [style.width]="'400px'"
      ></app-busca-colaboradores>
      <button
        pButton
        type="button"
        label="Adicionar"
        [disabled]="desabilitar || loading"
        (click)="buscarColaboradorSelecionado()"
      ></button>
      <button
        pButton
        type="button"
        [label]="'Buscar Todos' + (nSkip > 0 ? ' (+10)' : '')"
        [disabled]="desabilitar || loading"
        (click)="buscarTodosColaboradores()"
      ></button>
    </div>
  </div>

  <br />

  <p-table
    [value]="listaColaboradoresPorData || []"
    dataKey="NMatricula"
    [tableStyle]="{ 'min-width': '50rem' }"
    scrollHeight="flex"
    [frozenWidth]="'700px'"
    [scrollable]="true"
    scrollHeight="600px"
    [loading]="loading"
    *ngIf="listaColaboradoresPorData.length > 0 || loading"
  >
    <ng-template pTemplate="header">
      <tr>
        <th></th>
        <th style="width: 100%">Nome</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-colaborador let-expanded="expanded">
      <tr>
        <td>
          <p-button
            type="button"
            pRipple
            [pRowToggler]="colaborador"
            [text]="true"
            [rounded]="true"
            [plain]="true"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
          />
        </td>
        <td style="width: 100%">
          {{ colaborador.ANome || "" }}
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="rowexpansion" let-colaborador>
      <tr>
        <td colspan="7">
          <div class="p-3">
            <p-table [value]="colaborador.projetos" dataKey="ANome">
              <ng-template pTemplate="header">
                <tr>
                  <th></th>
                  <th class="centro">Projeto</th>
                  <th class="centro">Tipo Alocação</th>
                  <th *ngFor="let dataColuna of listaColunas" class="centro">
                    {{ dataColuna }}
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-projetos>
                <tr>
                  <td></td>
                  <td pFrozenColumn style="width: 200px">
                    {{ projetos.ANome || "" }}
                  </td>
                  <td pFrozenColumn style="width: 200px">
                    {{
                      projetos.AFullTime == "S" ? "Full-Time" : "Não Full-Time"
                    }}
                  </td>
                  <td *ngFor="let dataColuna of listaColunas" class="centro">
                    {{ obterTipoLancamento(projetos, dataColuna) }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog
    header="Filtro de Datas"
    [modal]="true"
    [(visible)]="apresentarFiltroData"
    [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
    [style]="{ width: '50vw' }"
    [draggable]="false"
    [resizable]="false"
  >
    <div class="flex align-items-center gap-3 mb-3">
      <label class="font-semibold w-6rem">Data Início</label>
      <p-calendar
        dateFormat="dd/mm/yy"
        [(ngModel)]="dataInicio"
        appendTo="body"
      />
    </div>
    <div class="flex align-items-center gap-3 mb-5">
      <label class="font-semibold w-6rem">Data Final</label>
      <p-calendar
        dateFormat="dd/mm/yy"
        [(ngModel)]="dataFinal"
        appendTo="body"
        [ngClass]="{
          'ng-invalid ng-dirty': erroNasDatas
        }"
      />
      <span *ngIf="erroNasDatas" class="p-error">
        Data Início maior que a Final.
      </span>
    </div>

    <div class="flex justify-content-end gap-2">
      <p-button
        label="Cancelar"
        severity="secondary"
        (onClick)="apresentarFiltroData = false"
      />
      <p-button label="Buscar" (onClick)="aplicarFiltroData()" />
    </div>
  </p-dialog>
</p-card>
